<!-- Test client; not the real thing -->

<!DOCTYPE html>
<html>
  <head>
    <title>Test Client</title>
    <script type="text/javascript" src="/jquery"></script>
  </head>

  <body>
    <input id="image-file" type="file" accept="image/*" /><br /><br />
    <img id="display" src="#" alt="your uploaded image" style="max-width:600px" hidden /><br /><br />
    <button id="submit" onclick="submit()" hidden>Submit</button>
  </body>

  <script type="text/javascript">
    $("#image-file").change(function() { readURL(this); });

    function readURL(element) {
      if (element.files && element.files[0]) {
        var reader = new FileReader();
        reader.readAsDataURL(element.files[0]);
        reader.onloadend = e => {
          $("#display").attr("src", e.target.result);
          $("#display").show();
          $("#submit").show();
        };
      }
    }

    function submit() {
      files = document.getElementById("image-file").files;
      if (!files || !files[0]) return;
      var reader = new FileReader();
      reader.readAsBinaryString(files[0]);
      reader.onloadend = async () => {
        const response = await fetch("/clarifai", {
          method: "POST",
          headers: {
            "Accept": "application/json",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            image: reader.result
          })
        });
        const content = await response.text();
        console.log(content);
        console.log(JSON.parse(content));
      };
    }
  </script>
</html
